// Markdown示例内容
const markdownContent = `# 自然与阅读的奇妙旅程

**发布日期：2025年7月21日 | 阅读时间：15分钟**

**标签：** #自然 #阅读 #文学

![自然风景](https://p3-doubao-search-sign.byteimg.com/labis/01604f22773b7e8545db79539b91059b~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1765244729&x-signature=QlZr0fk26ZW2HFS8fDgs67N6bQI%3D)

大自然的壮丽景色，常常是文学创作的灵感源泉

## 第一章：自然的呼唤

当我们漫步在大自然中，心灵仿佛被洗涤一新。清澈的溪流、巍峨的山脉、广袤的森林，每一处景色都像是大自然精心绘制的画卷，等待我们去欣赏和解读。

在这个快节奏的现代社会，我们常常被各种电子设备和信息洪流所包围，很少有机会静下心来，感受大自然的美好。然而，正是在与自然的亲密接触中，我们才能找回内心的平静和安宁。

![非洲草原风景](https://p3-doubao-search-search-sign.byteimg.com/labis/d38dfcd9f5f915155524631c21e2e183~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1765244730&x-signature=bsvuzUfhK5Ixx72v17yFbYSBiAk%3D)

非洲草原的日落，大自然最壮丽的表演之一

大自然不仅是视觉的盛宴，更是心灵的导师。它教会我们耐心，因为一棵小树需要多年才能长成参天大树；它教会我们坚韧，因为岩石中的种子依然能生根发芽；它还教会我们谦逊，因为在浩瀚的宇宙面前，人类显得如此渺小。

阅读与自然有着异曲同工之妙。一本好书就像是一次心灵的旅行，带领我们探索未知的世界，体验不同的人生。在阅读中，我们可以与古今中外的智者对话，汲取他们的智慧和经验。

## 第二章：阅读的艺术

阅读是一门艺术，需要我们用心去体会和感受。一个舒适的阅读环境，可以大大提升我们的阅读体验。想象一下，在一个阳光明媚的下午，坐在窗边的摇椅上，手中捧着一本好书，旁边放着一杯热茶，这是多么惬意的事情啊！

![舒适的阅读角落](https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/1283aab710c24a9a8ce17979b8c41951~tplv-a9rns2rl98-image.image?rcl=202510100945212D9E28186E242AAAF000&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1762652743&x-signature=FwKYSaZlxNeX9bj2JyQpN3DYTf4%3D)

一个温馨舒适的阅读角落，是阅读爱好者的天堂

阅读不仅仅是为了获取知识，更是为了培养我们的想象力和创造力。当我们阅读一本小说时，我们会不自觉地在脑海中构建故事的场景和人物的形象，这正是想象力发挥作用的过程。

不同的人有不同的阅读习惯和偏好。有些人喜欢在安静的环境中阅读，有些人则喜欢在嘈杂的咖啡馆里阅读；有些人喜欢纸质书的质感，有些人则偏爱电子书的便捷。无论我们选择哪种阅读方式，最重要的是享受阅读的过程。

### 阅读小贴士

- 选择适合自己的阅读环境，尽量减少干扰
- 根据自己的兴趣和需求选择合适的书籍
- 阅读时可以做笔记，记录自己的思考和感受
- 定期回顾已读的书籍，巩固所学知识
- 尝试不同类型的书籍，拓宽自己的视野

## 第三章：文字的力量

文字是人类最伟大的发明之一，它让我们能够记录思想、传承文化、交流情感。一篇好的文章，不仅仅是文字的堆砌，更是作者思想和情感的结晶。

![优雅的排版](https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/4910354057a54c468515a0db05999fc3~tplv-a9rns2rl98-image.image?rcl=202510100945212D9E28186E242AAAF000&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1762652742&x-signature=%2FvwTCS%2FQQOGF975U01o%2FhFwiJlY%3D)

优雅的排版和字体选择，能提升阅读的愉悦感

好的文字能够触动我们的心灵，引发我们的思考，甚至改变我们的人生。正如作家尼尔·盖曼所说："一本书是一种梦想，由作者精心编织，然后交给读者去继续编织。"

阅读不仅能够丰富我们的知识，还能够培养我们的 empathy（同理心）。当我们阅读小说时，我们会代入到不同的角色中，体验他们的喜怒哀乐，这让我们能够更好地理解他人的感受和想法。

> "书籍是人类进步的阶梯。"
> —— 高尔基

在这个信息爆炸的时代，我们每天都会接触到大量的文字信息。然而，真正有价值的内容并不多。因此，我们需要学会筛选和辨别，选择那些能够真正丰富我们内心世界的书籍和文章。

## 第四章：想象的翅膀

阅读的魅力在于它能够激发我们的想象力。当我们阅读一本小说时，我们会在脑海中构建出故事的场景和人物的形象，这是一种非常奇妙的体验。

![悉尼歌剧院夜景](https://p3-doubao-search-sign.byteimg.com/labis/48c7f26e4030ed8e1fc0ee7004ad0f01~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1765244729&x-signature=Oif%2FtiuUJ%2FDVtqVuN4OLDJnsITU%3D)

夜晚的悉尼歌剧院，建筑与艺术的完美结合

想象力是创造力的源泉，它让我们能够超越现实的束缚，探索未知的可能性。通过阅读，我们可以锻炼和提升自己的想象力，从而在生活和工作中更具创造力。

不同类型的书籍会激发不同形式的想象力。科幻小说让我们想象未来的世界和科技的发展；奇幻小说让我们进入一个充满魔法和神秘的世界；历史小说则让我们穿越时空，体验过去的生活。

#### 科幻小说的魅力
科幻小说让我们思考科技发展对人类社会的影响，探索未来的可能性。它激发我们对科学和未知的好奇心，培养我们的创新思维。

#### 文学作品的价值
文学作品通过细腻的描写和深刻的洞察，让我们更好地理解人性和社会。它培养我们的审美能力和人文素养，丰富我们的内心世界。

无论是哪种类型的书籍，它们都能够为我们打开一扇通往新世界的大门，让我们的想象力自由飞翔。在这个过程中，我们不仅能够获得知识和乐趣，还能够培养自己的创造力和思维能力。

## 第五章：心灵的旅程

阅读是一段心灵的旅程，它让我们能够在文字的世界中探索自我，发现生命的意义。每一本书都是一次新的冒险，每一次阅读都是一次心灵的洗礼。

![瀑布风景](https://p3-doubao-search-sign.byteimg.com/labis/2da6b1c38fac2d99f571e4b425c838c3~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1765244729&x-signature=n18hpgp6nFKgmZ8cPD6tmoXDtEc%3D)

瀑布的壮丽景色，象征着生命的力量和不断前进的精神

在阅读的过程中，我们会遇到各种各样的人物和故事，这些都会对我们的人生产生深远的影响。有些书籍会改变我们的思维方式，有些书籍会启发我们的人生方向，还有些书籍则会成为我们人生的良师益友。

阅读不仅能够丰富我们的内心世界，还能够帮助我们更好地理解这个复杂的世界。通过阅读，我们可以接触到不同的文化、观念和思想，从而拓宽自己的视野，培养自己的批判性思维。

### 推荐阅读书单

1. **《百年孤独》** 加西亚·马尔克斯
   一部充满魔幻现实主义色彩的经典之作，讲述了布恩迪亚家族七代人的传奇故事。

2. **《追风筝的人》** 卡勒德·胡赛尼
   一个关于爱、背叛与救赎的故事，展现了人性的复杂和生命的脆弱。

3. **《解忧杂货店》** 东野圭吾
   一个穿越时空的奇妙故事，探讨了命运与选择的关系，充满了温暖和希望。

阅读是一段永无止境的旅程，它让我们能够在文字的世界中探索自我，发现生命的意义。让我们一起踏上这段奇妙的阅读之旅，在书海中寻找心灵的慰藉和成长的力量。
`;

// DOM加载完成后执行
document.addEventListener('DOMContentLoaded', function() {
  // 初始化AOS动画库
  AOS.init({
    duration: 800,
    easing: 'ease-in-out',
    once: true
  });
  
  // 初始化Markdown编辑器
  initMarkdownEditor();
  
  // 初始化阅读设置
  initReadingSettings();
  
  // 初始化事件监听
  initEventListeners();
  
  // 初始化阅读进度条
  initProgressBar();
  
  // 检查并应用保存的阅读设置
  loadSavedSettings();
});

// 初始化Markdown编辑器
function initMarkdownEditor() {
  // 创建Markdown编辑器
  window.simplemde = new SimpleMDE({
    element: document.getElementById('markdown-editor'),
    spellChecker: false,
    autosave: {
      enabled: true,
      uniqueId: 'elegant-reading-page',
      delay: 1000,
    },
    placeholder: '在此输入Markdown内容...',
    toolbar: [
      'bold', 'italic', 'heading', '|',
      'code', 'quote', 'unordered-list', 'ordered-list', '|',
      'link', 'image', 'table', '|',
      'preview', 'side-by-side', 'fullscreen', '|',
      'guide'
    ]
  });
  
  // 设置初始内容
  window.simplemde.value(markdownContent);
  
  // 初始渲染Markdown内容
  renderMarkdownContent();
}

// 渲染Markdown内容
function renderMarkdownContent() {
  const markdownText = window.simplemde.value();
  const htmlContent = window.simplemde.markdown(markdownText);
  
  // 将渲染后的HTML内容插入到文章容器中
  const articleContent = document.getElementById('article-content');
  articleContent.innerHTML = htmlContent;
  
  // 为所有图片添加点击事件
  const images = articleContent.querySelectorAll('img');
  images.forEach(image => {
    image.classList.add('cursor-pointer', 'image-zoom');
    image.addEventListener('click', function() {
      openModal(this.src);
    });
  });
  
  // 为所有章节添加ID，用于导航
  const headings = articleContent.querySelectorAll('h2');
  headings.forEach((heading, index) => {
    heading.id = 'chapter-' + (index + 1);
  });
  
  // 更新目录
  updateTableOfContents();
}

// 更新目录
function updateTableOfContents() {
  const sidebar = document.getElementById('sidebar');
  const nav = sidebar.querySelector('nav ul');
  
  // 清空现有目录
  nav.innerHTML = '';
  
  // 获取所有章节标题
  const headings = document.querySelectorAll('#article-content h2');
  
  // 为每个标题创建目录项
  headings.forEach((heading, index) => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    
    a.href = '#' + heading.id;
    a.textContent = (index + 1) + '：' + heading.textContent;
    a.className = 'block p-2 rounded-lg hover:bg-gray-100 transition-colors';
    
    li.appendChild(a);
    nav.appendChild(li);
  });
}

// 初始化阅读设置
function initReadingSettings() {
  // 布局设置
  const layoutButtons = document.querySelectorAll('.layout-btn');
  layoutButtons.forEach(button => {
    button.addEventListener('click', function() {
      const layout = this.getAttribute('data-layout');
      setLayout(layout);
      
      // 更新按钮样式
      layoutButtons.forEach(btn => {
        btn.classList.remove('bg-blue-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      this.classList.remove('bg-gray-200', 'text-gray-700');
      this.classList.add('bg-blue-500', 'text-white');
    });
  });
  
  // 字体设置
  const fontButtons = document.querySelectorAll('.font-btn');
  fontButtons.forEach(button => {
    button.addEventListener('click', function() {
      const font = this.getAttribute('data-font');
      setFont(font);
      
      // 更新按钮样式
      fontButtons.forEach(btn => {
        btn.classList.remove('bg-blue-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      this.classList.remove('bg-gray-200', 'text-gray-700');
      this.classList.add('bg-blue-500', 'text-white');
    });
  });
  
  // 字体大小设置
  const fontSizeSlider = document.getElementById('font-size-slider');
  const fontSizeDecrease = document.getElementById('font-size-decrease');
  const fontSizeIncrease = document.getElementById('font-size-increase');
  
  fontSizeSlider.addEventListener('input', function() {
    setFontSize(this.value);
  });
  
  fontSizeDecrease.addEventListener('click', function() {
    const currentValue = parseInt(fontSizeSlider.value);
    if (currentValue > 1) {
      fontSizeSlider.value = currentValue - 1;
      setFontSize(fontSizeSlider.value);
    }
  });
  
  fontSizeIncrease.addEventListener('click', function() {
    const currentValue = parseInt(fontSizeSlider.value);
    if (currentValue < 4) {
      fontSizeSlider.value = currentValue + 1;
      setFontSize(fontSizeSlider.value);
    }
  });
  
  // 行高设置
  const lineHeightButtons = document.querySelectorAll('.line-height-btn');
  lineHeightButtons.forEach(button => {
    button.addEventListener('click', function() {
      const lineHeight = this.getAttribute('data-line-height');
      setLineHeight(lineHeight);
      
      // 更新按钮样式
      lineHeightButtons.forEach(btn => {
        btn.classList.remove('bg-blue-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      this.classList.remove('bg-gray-200', 'text-gray-700');
      this.classList.add('bg-blue-500', 'text-white');
    });
  });
  
  // 主题设置
  const themeButtons = document.querySelectorAll('.theme-btn');
  themeButtons.forEach(button => {
    button.addEventListener('click', function() {
      const theme = this.getAttribute('data-theme');
      setTheme(theme);
      
      // 更新按钮样式
      themeButtons.forEach(btn => {
        btn.classList.remove('bg-blue-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      this.classList.remove('bg-gray-200', 'text-gray-700');
      this.classList.add('bg-blue-500', 'text-white');
    });
  });
}

// 初始化事件监听
function initEventListeners() {
  // 侧边栏切换
  const menuToggle = document.getElementById('menu-toggle');
  const closeSidebar = document.getElementById('close-sidebar');
  const sidebar = document.getElementById('sidebar');
  
  menuToggle.addEventListener('click', function() {
    sidebar.classList.toggle('-translate-x-full');
  });
  
  closeSidebar.addEventListener('click', function() {
    sidebar.classList.add('-translate-x-full');
  });
  
  // 搜索面板切换
  const searchToggle = document.getElementById('search-toggle');
  const searchPanel = document.getElementById('search-panel');
  
  searchToggle.addEventListener('click', function() {
    searchPanel.classList.toggle('hidden');
    
    // 如果显示搜索面板，自动聚焦搜索框
    if (!searchPanel.classList.contains('hidden')) {
      searchPanel.querySelector('input').focus();
    }
  });
  
  // 设置面板切换
  const settingsToggle = document.getElementById('settings-toggle');
  const closeSettings = document.getElementById('close-settings');
  const settingsPanel = document.getElementById('settings-panel');
  
  settingsToggle.addEventListener('click', function() {
    settingsPanel.classList.toggle('hidden');
  });
  
  closeSettings.addEventListener('click', function() {
    settingsPanel.classList.add('hidden');
  });
  
  // 编辑模式切换
  const editToggle = document.getElementById('edit-toggle');
  const editIcon = document.getElementById('edit-icon');
  const markdownEditor = document.getElementById('markdown-editor');
  const articleContent = document.getElementById('article-content');
  const saveButton = document.getElementById('save-content');
  
  editToggle.addEventListener('click', function() {
    // 切换编辑模式和阅读模式
    if (markdownEditor.style.display === 'block') {
      // 保存内容并切换到阅读模式
      renderMarkdownContent();
      markdownEditor.style.display = 'none';
      articleContent.style.display = 'block';
      editIcon.classList.remove('fa-eye');
      editIcon.classList.add('fa-pencil');
    } else {
      // 切换到编辑模式
      markdownEditor.style.display = 'block';
      articleContent.style.display = 'none';
      editIcon.classList.remove('fa-pencil');
      editIcon.classList.add('fa-eye');
      
      // 重新初始化编辑器以适应主题
      setTimeout(() => {
        window.simplemde.codemirror.refresh();
      }, 100);
    }
  });
  
  // 主题切换
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    setTheme(newTheme);
    
    // 更新主题按钮样式
    const themeButtons = document.querySelectorAll('.theme-btn');
    themeButtons.forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
      btn.classList.add('bg-gray-200', 'text-gray-700');
      
      if (btn.getAttribute('data-theme') === newTheme) {
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-blue-500', 'text-white');
      }
    });
  });
  
  // 返回顶部按钮
  const backToTopButton = document.getElementById('back-to-top');
  
  window.addEventListener('scroll', function() {
    if (window.pageYOffset > 300) {
      backToTopButton.classList.remove('opacity-0', 'invisible');
      backToTopButton.classList.add('opacity-100', 'visible');
    } else {
      backToTopButton.classList.remove('opacity-100', 'visible');
      backToTopButton.classList.add('opacity-0', 'invisible');
    }
  });
  
  backToTopButton.addEventListener('click', function() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
  
  // 点击页面其他区域关闭搜索面板和设置面板
  document.addEventListener('click', function(event) {
    // 搜索面板
    if (!searchPanel.contains(event.target) && event.target !== searchToggle) {
      searchPanel.classList.add('hidden');
    }
    
    // 设置面板
    if (!settingsPanel.contains(event.target) && event.target !== settingsToggle) {
      settingsPanel.classList.add('hidden');
    }
  });
  
  // 点击侧边栏链接关闭侧边栏
  const sidebarLinks = sidebar.querySelectorAll('a');
  sidebarLinks.forEach(link => {
    link.addEventListener('click', function() {
      sidebar.classList.add('-translate-x-full');
    });
  });
  
  // 导航栏滚动效果
  const header = document.getElementById('main-header');
  
  window.addEventListener('scroll', function() {
    if (window.pageYOffset > 50) {
      header.classList.add('shadow-md');
      header.classList.remove('shadow-sm');
    } else {
      header.classList.remove('shadow-md');
      header.classList.add('shadow-sm');
    }
  });
}

// 初始化阅读进度条
function initProgressBar() {
  const progressBar = document.getElementById('progress-bar');
  
  window.addEventListener('scroll', function() {
    const scrollTop = window.pageYOffset;
    const docHeight = document.body.offsetHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    
    progressBar.style.width = scrollPercent + '%';
    
    // 保存阅读进度
    saveReadingProgress(scrollPercent);
  });
}

// 设置布局
function setLayout(layout) {
  const articleContent = document.getElementById('article-content');
  
  // 移除所有布局类
  articleContent.classList.remove('layout-single', 'layout-double', 'layout-card');
  
  // 添加选中的布局类
  articleContent.classList.add('layout-' + layout);
  
  // 保存设置
  saveSetting('layout', layout);
}

// 设置字体
function setFont(font) {
  const articleContent = document.getElementById('article-content');
  
  // 移除所有字体类
  articleContent.classList.remove('font-sans', 'font-serif', 'font-mono');
  
  // 添加选中的字体类
  articleContent.classList.add('font-' + font);
  
  // 保存设置
  saveSetting('font', font);
}

// 设置字体大小
function setFontSize(size) {
  const articleContent = document.getElementById('article-content');
  
  // 移除所有字体大小类
  articleContent.classList.remove('font-size-sm', 'font-size-md', 'font-size-lg', 'font-size-xl');
  
  // 根据大小值添加对应的类
  const sizeClasses = ['', 'font-size-sm', 'font-size-md', 'font-size-lg', 'font-size-xl'];
  articleContent.classList.add(sizeClasses[size]);
  
  // 保存设置
  saveSetting('fontSize', size);
}

// 设置行高
function setLineHeight(lineHeight) {
  const articleContent = document.getElementById('article-content');
  
  // 移除所有行高类
  articleContent.classList.remove('line-height-tight', 'line-height-normal', 'line-height-relaxed');
  
  // 添加选中的行高类
  articleContent.classList.add('line-height-' + lineHeight);
  
  // 保存设置
  saveSetting('lineHeight', lineHeight);
}

// 设置主题
function setTheme(theme) {
  const html = document.documentElement;
  const body = document.getElementById('app-body');
  const header = document.getElementById('main-header');
  const themeIcon = document.getElementById('theme-icon');
  
  // 移除所有主题类
  body.classList.remove('bg-gray-50', 'bg-amber-50', 'bg-gray-900');
  body.classList.remove('text-gray-800', 'text-gray-700', 'text-gray-100');
  html.classList.remove('dark');
  
  // 根据主题设置样式
  if (theme === 'dark') {
    html.classList.add('dark');
    body.classList.add('bg-gray-900', 'text-gray-100');
    themeIcon.classList.remove('fa-moon-o');
    themeIcon.classList.add('fa-sun-o');
    
    // 调整编辑器主题
    if (window.simplemde) {
      window.simplemde.codemirror.setOption('theme', 'monokai');
    }
  } else if (theme === 'sepia') {
    body.classList.add('bg-amber-50', 'text-gray-700');
    themeIcon.classList.remove('fa-sun-o');
    themeIcon.classList.add('fa-moon-o');
    
    // 调整编辑器主题
    if (window.simplemde) {
      window.simplemde.codemirror.setOption('theme', 'eclipse');
    }
  } else {
    body.classList.add('bg-gray-50', 'text-gray-800');
    themeIcon.classList.remove('fa-sun-o');
    themeIcon.classList.add('fa-moon-o');
    
    // 调整编辑器主题
    if (window.simplemde) {
      window.simplemde.codemirror.setOption('theme', 'default');
    }
  }
  
  // 更新阅读卡片背景色
  const readingCards = document.querySelectorAll('.reading-card');
  readingCards.forEach(card => {
    if (theme === 'dark') {
      card.classList.remove('bg-white', 'bg-amber-100');
      card.classList.add('bg-gray-800');
    } else if (theme === 'sepia') {
      card.classList.remove('bg-white', 'bg-gray-800');
      card.classList.add('bg-amber-100');
    } else {
      card.classList.remove('bg-amber-100', 'bg-gray-800');
      card.classList.add('bg-white');
    }
  });
  
  // 保存设置
  saveSetting('theme', theme);
}

// 保存设置到localStorage
function saveSetting(key, value) {
  try {
    localStorage.setItem('readingSettings_' + key, value);
  } catch (e) {
    console.error('无法保存设置:', e);
  }
}

// 保存阅读进度
function saveReadingProgress(progress) {
  try {
    localStorage.setItem('readingProgress', progress);
  } catch (e) {
    console.error('无法保存阅读进度:', e);
  }
}

// 加载保存的设置
function loadSavedSettings() {
  // 布局设置
  const savedLayout = localStorage.getItem('readingSettings_layout');
  if (savedLayout) {
    setLayout(savedLayout);
    
    // 更新按钮样式
    const layoutButtons = document.querySelectorAll('.layout-btn');
    layoutButtons.forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
      btn.classList.add('bg-gray-200', 'text-gray-700');
      
      if (btn.getAttribute('data-layout') === savedLayout) {
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-blue-500', 'text-white');
      }
    });
  }
  
  // 字体设置
  const savedFont = localStorage.getItem('readingSettings_font');
  if (savedFont) {
    setFont(savedFont);
    
    // 更新按钮样式
    const fontButtons = document.querySelectorAll('.font-btn');
    fontButtons.forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
      btn.classList.add('bg-gray-200', 'text-gray-700');
      
      if (btn.getAttribute('data-font') === savedFont) {
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-blue-500', 'text-white');
      }
    });
  }
  
  // 字体大小设置
  const savedFontSize = localStorage.getItem('readingSettings_fontSize');
  if (savedFontSize) {
    const fontSizeSlider = document.getElementById('font-size-slider');
    fontSizeSlider.value = savedFontSize;
    setFontSize(savedFontSize);
  }
  
  // 行高设置
  const savedLineHeight = localStorage.getItem('readingSettings_lineHeight');
  if (savedLineHeight) {
    setLineHeight(savedLineHeight);
    
    // 更新按钮样式
    const lineHeightButtons = document.querySelectorAll('.line-height-btn');
    lineHeightButtons.forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
      btn.classList.add('bg-gray-200', 'text-gray-700');
      
      if (btn.getAttribute('data-line-height') === savedLineHeight) {
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-blue-500', 'text-white');
      }
    });
  }
  
  // 主题设置
  const savedTheme = localStorage.getItem('readingSettings_theme');
  if (savedTheme) {
    setTheme(savedTheme);
    
    // 更新按钮样式
    const themeButtons = document.querySelectorAll('.theme-btn');
    themeButtons.forEach(btn => {
      btn.classList.remove('bg-blue-500', 'text-white');
      btn.classList.add('bg-gray-200', 'text-gray-700');
      
      if (btn.getAttribute('data-theme') === savedTheme) {
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-blue-500', 'text-white');
      }
    });
  }
  
  // 阅读进度
  const savedProgress = localStorage.getItem('readingProgress');
  if (savedProgress && savedProgress > 0) {
    // 询问用户是否要继续阅读
    if (confirm('是否要继续上次的阅读进度？')) {
      const docHeight = document.body.offsetHeight - window.innerHeight;
      const scrollTop = (savedProgress / 100) * docHeight;
      
      window.scrollTo({
        top: scrollTop,
        behavior: 'smooth'
      });
    }
  }
}

// 图片预览功能
function openModal(imageSrc) {
  const modal = document.getElementById('image-modal');
  const modalImg = document.getElementById('modal-image');
  
  modal.style.display = 'flex';
  modalImg.src = imageSrc;
  
  // 禁止背景滚动
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  const modal = document.getElementById('image-modal');
  modal.style.display = 'none';
  
  // 恢复背景滚动
  document.body.style.overflow = 'auto';
}

// 点击模态框外部关闭
window.onclick = function(event) {
  const modal = document.getElementById('image-modal');
  if (event.target === modal) {
    closeModal();
  }
}

// 键盘导航
document.addEventListener('keydown', function(event) {
  const modal = document.getElementById('image-modal');
  
  // 按ESC键关闭模态框
  if (event.key === 'Escape' && modal.style.display === 'flex') {
    closeModal();
  }
  
  // 按箭头键滚动页面
  if (event.key === 'ArrowUp') {
    window.scrollBy({
      top: -100,
      behavior: 'smooth'
    });
  } else if (event.key === 'ArrowDown') {
    window.scrollBy({
      top: 100,
      behavior: 'smooth'
    });
  }
}
);
