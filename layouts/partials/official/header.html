<!-- 引入外部资源 -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

<!-- Tailwind 配置 -->
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: '#2D3142',
          secondary: '#EF8354',
          neutral: '#F2F4F3',
          accent: '#4F5D75',
        },
        fontFamily: {
          sans: ['Inter', 'system-ui', 'sans-serif'],
        },
      },
    }
  }
</script>

<!-- 自定义工具类 -->
<style type="text/tailwindcss">
  @layer utilities {
    .content-auto {
      content-visibility: auto;
    }
    .text-balance {
      text-wrap: balance;
    }
    .card-hover {
      @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
    }
    .section-padding {
      @apply py-16 md:py-24;
    }
  }
</style>

<!-- 全局样式 -->
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

  html {
    scroll-behavior: smooth;
  }

  .car-ad-display {
    position: relative;
    overflow: hidden;
  }

  .ad-position {
    position: absolute;
    border: 2px dashed rgba(239, 131, 84, 0.8);
    background-color: rgba(239, 131, 84, 0.1);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #EF8354;
    font-weight: 600;
  }

  .ad-position:hover {
    background-color: rgba(239, 131, 84, 0.2);
  }

  .ad-small-1 {
    top: 20%;
    left: 10%;
    width: 15%;
    height: 12%;
  }

  .ad-small-2 {
    top: 40%;
    right: 10%;
    width: 15%;
    height: 12%;
  }

  .ad-main {
    top: 60%;
    left: 25%;
    width: 50%;
    height: 20%;
  }

  .service-tab.active {
    color: #EF8354;
    border-bottom: 2px solid #EF8354;
  }

  .service-content {
    display: none;
  }

  .service-content.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<!-- 导航栏 -->
<header id="main-header" class="fixed w-full bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm shadow-sm dark:shadow-gray-800/50 z-50 transition-all duration-300 border-b border-gray-100 dark:border-gray-800">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <!-- Logo 区域 -->
      <div class="flex items-center row">
<svg width="31" height="16" viewBox="0 0 31 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 12.0909V1C0 0.447715 0.447716 0 1 0H12.2857C12.838 0 13.2857 0.447716 13.2857 1V7.72727C13.2857 8.27956 13.7334 8.72727 14.2857 8.72727H19.6667C20.219 8.72727 20.6667 8.27956 20.6667 7.72727V1C20.6667 0.447715 21.1144 0 21.6667 0H30C30.5523 0 31 0.447715 31 1V13.0909V15C31 15.5523 30.5523 16 30 16H21.6667C21.1144 16 20.6667 15.5523 20.6667 15V14.0909C20.6667 13.5386 20.219 13.0909 19.6667 13.0909H13.2857H1C0.447715 13.0909 0 12.6432 0 12.0909Z" fill="#FF9900" fill-opacity="0.5"/>
<path d="M0 15V1C0 0.447715 0.447716 0 1 0H12.2857C12.838 0 13.2857 0.447716 13.2857 1V7.72727C13.2857 8.27956 13.7334 8.72727 14.2857 8.72727H19.6667C20.219 8.72727 20.6667 8.27956 20.6667 7.72727V1C20.6667 0.447715 21.1144 0 21.6667 0H30C30.5523 0 31 0.447715 31 1V15C31 15.5523 30.5523 16 30 16H21.6667C21.1144 16 20.6667 15.5523 20.6667 15V14.0909C20.6667 13.5386 20.219 13.0909 19.6667 13.0909H14.2857C13.7334 13.0909 13.2857 13.5386 13.2857 14.0909V15C13.2857 15.5523 12.838 16 12.2857 16H1C0.447715 16 0 15.5523 0 15Z" fill="#FF9900" fill-opacity="0.5"/>
<path d="M0 15V1C0 0.447715 0.447716 0 1 0H12.2857C12.838 0 13.2857 0.447716 13.2857 1V7.72727C13.2857 8.27956 13.7334 8.72727 14.2857 8.72727H19.6667C20.219 8.72727 20.6667 9.17499 20.6667 9.72727V12.0909C20.6667 12.6432 21.1144 13.0909 21.6667 13.0909H30C30.5523 13.0909 31 13.5386 31 14.0909V15C31 15.5523 30.5523 16 30 16H1C0.447715 16 0 15.5523 0 15Z" fill="#FF9900" fill-opacity="0.5"/>
</svg>

        <a href="/" class="flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-secondary/50 rounded-md p-2">
          Lehuye
        
        <!-- <svg width="141" height="11" viewBox="0 0 141 11" fill="none" xmlns="http://www.w3.org/2000/svg" class="dark:invert">
          <path d="M0 11V0H9V6H14V9H21V11H0Z" fill="black" />
          <path d="M45 6H38V9H45V11H24V0H45V6ZM33 2V6H38V2H33Z" fill="black" />
          <path d="M48 11V0H57V6H62V0H69V11H62V9H57V11H48Z" fill="black" />
          <path d="M72 11V0H81V9H86V0H93V11H86H81H72Z" fill="black" />
          <path d="M96 9V0H105V6H110V0H117V9V11H110V9H105H96Z" fill="black" />
          <path d="M141 6H134V9H141V11H120V0H141V6ZM129 2V6H134V2H129Z" fill="black" />
        </svg> -->
        </a>
      </div>

      <!-- 桌面端导航 -->
      <nav class="hidden md:flex space-x-8">
        <a href="/" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">首页</a>
        <a href="/sponsors" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">赞助冠名</a>
        <a href="/partner" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">合作伙伴</a>
        <a href="/contact" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">联系我们</a>
      </nav>

      <!-- 移动端菜单按钮 -->
      <button class="md:hidden text-primary dark:text-primary-400 text-xl" id="mobile-menu-button">
        <i class="fa fa-bars"></i>
      </button>
    </div>

    <!-- 移动端菜单 -->
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="flex flex-col space-y-4 py-4 bg-white dark:bg-gray-900 rounded-md dark:border dark:border-gray-800 p-4">
        <a href="/" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">首页</a>
        <a href="/sponsors" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">赞助冠名</a>
        <a href="/partner" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">合作伙伴</a>
        <a href="/contact" class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">联系我们</a>
      </div>
    </div>
  </div>

  <!-- 设置区域（可选） -->
  <!-- <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
    <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-3">设置</h3>
    <button id="edit-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-pencil text-gray-700 dark:text-gray-300" id="edit-icon"></i>
    </button>
    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-moon-o text-gray-700 dark:text-gray-300" id="theme-icon"></i>
    </button>
    <button id="settings-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-cog text-gray-700 dark:text-gray-300"></i>
    </button>
  </div> -->
</header>

<!-- 返回顶部按钮（可选） -->
<button id="back-to-top" class="fixed bottom-6 right-6 bg-secondary text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg opacity-0 invisible transition-all duration-300 hover:bg-secondary/90 z-50">
  <i class="fa fa-arrow-up"></i>
</button>

<!-- 核心功能脚本（统一整合） -->
<script>
  // 所有逻辑包裹在 DOMContentLoaded 中，确保 DOM 加载完成
  document.addEventListener('DOMContentLoaded', function () {
    // -------------------------- 基础功能 --------------------------
    // 1. 移动端菜单切换
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        // 切换菜单图标（汉堡/叉号）
        const icon = mobileMenuButton.querySelector('i');
        if (mobileMenu.classList.contains('hidden')) {
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        } else {
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        }
      });
    }

    // 2. 深色模式切换（统一逻辑，移除重复）
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const html = document.documentElement;
    
    if (themeToggle && themeIcon) {
      // 初始化主题
      const initTheme = () => {
        const savedTheme = localStorage.getItem('theme');
        const isDark = savedTheme === 'dark' || 
          (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches);
        
        if (isDark) {
          html.classList.add('dark');
          themeIcon.classList.remove('fa-moon-o');
          themeIcon.classList.add('fa-sun-o');
        } else {
          html.classList.remove('dark');
          themeIcon.classList.remove('fa-sun-o');
          themeIcon.classList.add('fa-moon-o');
        }
      };

      // 切换主题
      themeToggle.addEventListener('click', () => {
        const isDark = html.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        
        if (isDark) {
          themeIcon.classList.remove('fa-moon-o');
          themeIcon.classList.add('fa-sun-o');
        } else {
          themeIcon.classList.remove('fa-sun-o');
          themeIcon.classList.add('fa-moon-o');
        }
      });

      initTheme(); // 执行初始化
    }

    // 3. 导航栏滚动效果
    const header = document.getElementById('main-header');
    if (header) {
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 50) {
          header.classList.add('shadow-md');
          header.classList.remove('shadow-sm');
        } else {
          header.classList.remove('shadow-md');
          header.classList.add('shadow-sm');
        }
      });
    }

    // 4. 返回顶部按钮
    const backToTopButton = document.getElementById('back-to-top');
    if (backToTopButton) {
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          backToTopButton.classList.remove('opacity-0', 'invisible');
          backToTopButton.classList.add('opacity-100', 'visible');
        } else {
          backToTopButton.classList.remove('opacity-100', 'visible');
          backToTopButton.classList.add('opacity-0', 'invisible');
        }
      });

      backToTopButton.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // -------------------------- 高级功能（按需启用） --------------------------
    // 遮罩管理工具
    const maskManager = {
      createMask() {
        if (document.getElementById('sidebar-mask')) return;
        
        const mask = document.createElement('div');
        mask.id = 'sidebar-mask';
        mask.className = 'fixed inset-0 bg-black/50 dark:bg-black/70 z-40 transition-opacity duration-300 opacity-0 backdrop-blur-sm';
        document.body.appendChild(mask);
        
        setTimeout(() => mask.classList.replace('opacity-0', 'opacity-100'), 10);
        
        mask.addEventListener('click', () => {
          const sidebar = document.getElementById('sidebar');
          const sidebarRight = document.getElementById('sidebar-right');
          if (sidebar) sidebar.classList.add('-translate-x-full');
          if (sidebarRight) sidebarRight.classList.add('translate-x-full');
          this.removeMask();
        });
      },
      removeMask() {
        const mask = document.getElementById('sidebar-mask');
        if (!mask) return;
        
        mask.classList.replace('opacity-100', 'opacity-0');
        setTimeout(() => mask.remove(), 300);
      },
      hasOpenSidebar(sidebar, sidebarRight) {
        return (sidebar && !sidebar.classList.contains('-translate-x-full')) ||
          (sidebarRight && !sidebarRight.classList.contains('translate-x-full'));
      }
    };

    // 左侧边栏逻辑（若有侧边栏元素则启用）
    const menuToggle = document.getElementById('menu-toggle');
    const closeSidebar = document.getElementById('close-sidebar');
    const sidebar = document.getElementById('sidebar');
    if (menuToggle && closeSidebar && sidebar) {
      menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
        if (!sidebar.classList.contains('-translate-x-full')) {
          maskManager.createMask();
        } else {
          maskManager.removeMask();
        }
      });

      closeSidebar.addEventListener('click', () => {
        sidebar.classList.add('-translate-x-full');
        maskManager.removeMask();
      });

      // 点击侧边栏链接关闭侧边栏
      sidebar.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          sidebar.classList.add('-translate-x-full');
          maskManager.removeMask();
        });
      });
    }

    // 右侧边栏逻辑（若有右侧边栏元素则启用）
    const menuRightToggle = document.getElementById('menu-right-toggle');
    const closeSidebarRight = document.getElementById('close-sidebar-right');
    const sidebarRight = document.getElementById('sidebar-right');
    if (menuRightToggle && closeSidebarRight && sidebarRight) {
      menuRightToggle.addEventListener('click', () => {
        sidebarRight.classList.toggle('translate-x-full');
        if (!sidebarRight.classList.contains('translate-x-full')) {
          maskManager.createMask();
        } else {
          maskManager.removeMask();
        }
      });

      closeSidebarRight.addEventListener('click', () => {
        sidebarRight.classList.add('translate-x-full');
        maskManager.removeMask();
      });
    }

    // 搜索面板切换（若有搜索元素则启用）
    const searchToggle = document.getElementById('search-toggle');
    const searchPanel = document.getElementById('search-panel');
    if (searchToggle && searchPanel) {
      searchToggle.addEventListener('click', () => {
        searchPanel.classList.toggle('hidden');
        if (!searchPanel.classList.contains('hidden')) {
          const searchInput = searchPanel.querySelector('input');
          if (searchInput) searchInput.focus();
        }
      });

      // 点击外部关闭搜索面板
      document.addEventListener('click', (e) => {
        if (!searchPanel.contains(e.target) && e.target !== searchToggle) {
          searchPanel.classList.add('hidden');
        }
      });
    }

    // 设置面板切换（若有设置元素则启用）
    const settingsToggle = document.getElementById('settings-toggle');
    const closeSettings = document.getElementById('close-settings');
    const settingsPanel = document.getElementById('settings-panel');
    if (settingsToggle && closeSettings && settingsPanel) {
      settingsToggle.addEventListener('click', () => settingsPanel.classList.toggle('hidden'));
      closeSettings.addEventListener('click', () => settingsPanel.classList.add('hidden'));

      // 点击外部关闭设置面板
      document.addEventListener('click', (e) => {
        if (!settingsPanel.contains(e.target) && e.target !== settingsToggle) {
          settingsPanel.classList.add('hidden');
        }
      });
    }

    // 编辑模式切换（若有编辑器元素则启用）
    const editToggle = document.getElementById('edit-toggle');
    const editIcon = document.getElementById('edit-icon');
    const markdownEditor = document.getElementById('markdown-editor');
    const articleContent = document.getElementById('article-content');
    if (editToggle && editIcon && markdownEditor && articleContent) {
      editToggle.addEventListener('click', () => {
        if (markdownEditor.style.display === 'block') {
          // 渲染 Markdown 内容（需确保 renderMarkdownContent 函数已定义）
          if (window.renderMarkdownContent) renderMarkdownContent();
          markdownEditor.style.display = 'none';
          articleContent.style.display = 'block';
          editIcon.classList.remove('fa-eye');
          editIcon.classList.add('fa-pencil');
        } else {
          markdownEditor.style.display = 'block';
          articleContent.style.display = 'none';
          editIcon.classList.remove('fa-pencil');
          editIcon.classList.add('fa-eye');

          // 刷新编辑器
          setTimeout(() => {
            if (window.simplemde && window.simplemde.codemirror) {
              window.simplemde.codemirror.refresh();
            }
          }, 100);
        }
      });
    }
  });
</script>