<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: '#2D3142',
          secondary: '#EF8354',
          neutral: '#F2F4F3',
          accent: '#4F5D75',
        },
        fontFamily: {
          sans: ['Inter', 'system-ui', 'sans-serif'],
        },
      },
    }
  }
</script>
<style type="text/tailwindcss">
  @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-balance {
        text-wrap: balance;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .section-padding {
        @apply py-16 md:py-24;
      }
    }
  </style>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

  html {
    scroll-behavior: smooth;
  }

  .car-ad-display {
    position: relative;
    overflow: hidden;
  }

  .ad-position {
    position: absolute;
    border: 2px dashed rgba(239, 131, 84, 0.8);
    background-color: rgba(239, 131, 84, 0.1);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #EF8354;
    font-weight: 600;
  }

  .ad-position:hover {
    background-color: rgba(239, 131, 84, 0.2);
  }

  .ad-small-1 {
    top: 20%;
    left: 10%;
    width: 15%;
    height: 12%;
  }

  .ad-small-2 {
    top: 40%;
    right: 10%;
    width: 15%;
    height: 12%;
  }

  .ad-main {
    top: 60%;
    left: 25%;
    width: 50%;
    height: 20%;
  }

  .service-tab.active {
    color: #EF8354;
    border-bottom: 2px solid #EF8354;
  }

  .service-content {
    display: none;
  }

  .service-content.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
<!-- 导航栏 -->
<header
  class="fixed w-full bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm shadow-sm dark:shadow-gray-800/50 z-50 transition-all duration-300 border-b border-gray-100 dark:border-gray-800">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <a href="/" class="flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-secondary/50 rounded-md p-1">
        Houdini
        <!-- <svg width="141" height="11" viewBox="0 0 141 11" fill="none" xmlns="http://www.w3.org/2000/svg" class="dark:invert">
          <path d="M0 11V0H9V6H14V9H21V11H0Z" fill="black" />
          <path d="M45 6H38V9H45V11H24V0H45V6ZM33 2V6H38V2H33Z" fill="black" />
          <path d="M48 11V0H57V6H62V0H69V11H62V9H57V11H48Z" fill="black" />
          <path d="M72 11V0H81V9H86V0H93V11H86H81H72Z" fill="black" />
          <path d="M96 9V0H105V6H110V0H117V9V11H110V9H105H96Z" fill="black" />
          <path d="M141 6H134V9H141V11H120V0H141V6ZM129 2V6H134V2H129Z" fill="black" />
        </svg> -->
      </a>

      <nav class="hidden md:flex space-x-8">
        <a href="/"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">首页</a>
        <a href="/sponsors"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">赞助冠名</a>
        <a href="/partner"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">合作伙伴</a>
        <a href="/contact"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">联系我们</a>
      </nav>

      <button class="md:hidden text-primary dark:text-primary-400 text-xl" id="mobile-menu-button">
        <i class="fa fa-bars"></i>
      </button>
    </div>

    <div class="md:hidden hidden" id="mobile-menu">
      <div
        class="flex flex-col space-y-4 py-4 bg-white dark:bg-gray-900 rounded-md dark:border dark:border-gray-800 p-4">
        <a href="/"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">首页</a>
        <a href="/sponsors"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">赞助冠名</a>
        <a href="/partner"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">合作伙伴</a>
        <a href="/contact"
          class="text-accent dark:text-gray-300 hover:text-secondary dark:hover:text-secondary-400 transition-colors">联系我们</a>
      </div>
    </div>
  </div>

  <!-- <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
    <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-3">设置</h3>
    <button id="edit-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-pencil text-gray-700 dark:text-gray-300" id="edit-icon"></i>
    </button>
    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-moon-o text-gray-700 dark:text-gray-300" id="theme-icon"></i>
    </button>
    <button id="settings-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
      <i class="fa fa-cog text-gray-700 dark:text-gray-300"></i>
    </button>
  </div> -->
</header>

<!-- 可选：添加深色模式切换的JS逻辑 -->
<script>
  // 移动端菜单切换
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  }

  // 深色模式切换
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');

  // 初始化深色模式（从本地存储读取）
  if (localStorage.getItem('darkMode') === 'true' ||
    (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
    themeIcon.classList.remove('fa-moon-o');
    themeIcon.classList.add('fa-sun-o');
  }

  // 切换深色模式
  if (themeToggle && themeIcon) {
    themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('darkMode', isDark);

      // 切换图标
      if (isDark) {
        themeIcon.classList.remove('fa-moon-o');
        themeIcon.classList.add('fa-sun-o');
      } else {
        themeIcon.classList.remove('fa-sun-o');
        themeIcon.classList.add('fa-moon-o');
      }
    });
  }
</script>



<script>
  const menuToggle = document.getElementById('menu-toggle');
  if (menuToggle) {
    function menuToggleFun() {
      console.log('Menu toggle function called');
      const menu = document.querySelector('.phone-menu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }
  }



  // 所有逻辑统一包裹在 DOMContentLoaded 中，确保 DOM 加载完成
  document.addEventListener('DOMContentLoaded', function () {
    // 1. 先初始化主题切换（避免依赖其他逻辑）
    initThemeToggle();

    // 2. 再初始化其他事件（侧边栏、搜索等）
    initOtherEventListeners();


    // -------------------------- 主题切换逻辑 --------------------------
    function initThemeToggle() {
      // 获取主题相关元素
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon'); // 用图标替代 btnText，更直观
      const html = document.documentElement;

      // 检查元素是否存在，避免报错
      if (!themeToggle || !themeIcon) {
        console.warn('主题切换按钮或图标未找到');
        return;
      }

      // 初始化主题（读取本地存储/系统偏好）
      function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        const isDark = savedTheme === 'dark' ||
          (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches);

        if (isDark) {
          html.classList.add('dark');
          themeIcon.classList.remove('fa-moon-o');
          themeIcon.classList.add('fa-sun-o'); // 深色模式显示太阳图标
        } else {
          html.classList.remove('dark');
          themeIcon.classList.remove('fa-sun-o');
          themeIcon.classList.add('fa-moon-o'); // 浅色模式显示月亮图标
        }
      }

      // 切换主题逻辑
      function toggleTheme() {
        const isDark = html.classList.toggle('dark');

        // 更新图标（比文字更简洁）
        if (isDark) {
          themeIcon.classList.remove('fa-moon-o');
          themeIcon.classList.add('fa-sun-o');
          localStorage.setItem('theme', 'dark');
        } else {
          themeIcon.classList.remove('fa-sun-o');
          themeIcon.classList.add('fa-moon-o');
          localStorage.setItem('theme', 'light');
        }
      }

      // 绑定点击事件（唯一触发方式）
      themeToggle.addEventListener('click', toggleTheme);

      // 初始化主题
      initTheme();
    }


    // -------------------------- 其他事件逻辑（侧边栏、搜索等） --------------------------
    function initOtherEventListeners() {
      // 遮罩管理工具函数
      const maskManager = {
        createMask() {
          if (document.getElementById('sidebar-mask')) return;

          const mask = document.createElement('div');
          mask.id = 'sidebar-mask';
          mask.className = 'fixed inset-0 bg-black/50 dark:bg-black/70 z-40 transition-opacity duration-300 opacity-0 backdrop-blur-sm';
          document.body.appendChild(mask);

          setTimeout(() => mask.classList.replace('opacity-0', 'opacity-100'), 10);

          // 点击遮罩关闭所有侧边栏
          mask.addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarRight = document.getElementById('sidebar-right');
            if (sidebar) sidebar.classList.add('-translate-x-full');
            if (sidebarRight) sidebarRight.classList.add('translate-x-full');
            this.removeMask();
          });
        },

        removeMask() {
          const mask = document.getElementById('sidebar-mask');
          if (!mask) return;

          mask.classList.replace('opacity-100', 'opacity-0');
          setTimeout(() => mask.remove(), 300);
        },

        hasOpenSidebar(sidebar, sidebarRight) {
          return (sidebar && !sidebar.classList.contains('-translate-x-full')) ||
            (sidebarRight && !sidebarRight.classList.contains('translate-x-full'));
        }
      };


      // 左侧边栏逻辑
      const menuToggle = document.getElementById('menu-toggle');
      const closeSidebar = document.getElementById('close-sidebar');
      const sidebar = document.getElementById('sidebar');

      if (menuToggle && closeSidebar && sidebar) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('-translate-x-full');
          if (sidebar.classList.contains('-translate-x-full')) {
            if (!maskManager.hasOpenSidebar(sidebar, document.getElementById('sidebar-right'))) {
              // maskManager.removeMask(); //移除遮罩
            }
          } else {
            // maskManager.createMask(); //创建遮罩 这里不需要了了，会挡住当前内容，注释掉
          }
        });

        closeSidebar.addEventListener('click', () => {
          sidebar.classList.add('-translate-x-full');
          if (!maskManager.hasOpenSidebar(sidebar, document.getElementById('sidebar-right'))) {
            maskManager.removeMask();
          }
        });

        // 点击侧边栏链接关闭侧边栏
        sidebar.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => sidebar.classList.add('-translate-x-full'));
        });
      }


      // 右侧边栏逻辑
      const menuRightToggle = document.getElementById('menu-right-toggle');
      const closeSidebarRight = document.getElementById('close-sidebar-right');
      const sidebarRight = document.getElementById('sidebar-right');

      if (menuRightToggle && closeSidebarRight && sidebarRight) {
        menuRightToggle.addEventListener('click', () => {
          sidebarRight.classList.toggle('translate-x-full');
          if (sidebarRight.classList.contains('translate-x-full')) {
            if (!maskManager.hasOpenSidebar(document.getElementById('sidebar'), sidebarRight)) {
              maskManager.removeMask();
            }
          } else {
            maskManager.createMask();
          }
        });

        closeSidebarRight.addEventListener('click', () => {
          sidebarRight.classList.add('translate-x-full');
          if (!maskManager.hasOpenSidebar(document.getElementById('sidebar'), sidebarRight)) {
            maskManager.removeMask();
          }
        });
      }


      // 搜索面板切换（需确保元素存在）
      const searchToggle = document.getElementById('search-toggle');
      const searchPanel = document.getElementById('search-panel');
      if (searchToggle && searchPanel) {
        searchToggle.addEventListener('click', () => {
          searchPanel.classList.toggle('hidden');
          if (!searchPanel.classList.contains('hidden')) {
            const searchInput = searchPanel.querySelector('input');
            if (searchInput) searchInput.focus();
          }
        });
      }


      // 设置面板切换（需确保元素存在）
      const settingsToggle = document.getElementById('settings-toggle');
      const closeSettings = document.getElementById('close-settings');
      const settingsPanel = document.getElementById('settings-panel');
      if (settingsToggle && closeSettings && settingsPanel) {
        settingsToggle.addEventListener('click', () => settingsPanel.classList.toggle('hidden'));
        closeSettings.addEventListener('click', () => settingsPanel.classList.add('hidden'));
      }


      // 编辑模式切换（需确保元素存在）
      const editToggle = document.getElementById('edit-toggle');
      const editIcon = document.getElementById('edit-icon');
      const markdownEditor = document.getElementById('markdown-editor');
      const articleContent = document.getElementById('article-content');
      const saveButton = document.getElementById('save-content');
      if (editToggle && editIcon && markdownEditor && articleContent) {
        editToggle.addEventListener('click', () => {
          if (markdownEditor.style.display === 'block') {
            // 假设 renderMarkdownContent 已定义（若未定义需补充）
            if (window.renderMarkdownContent) renderMarkdownContent();
            markdownEditor.style.display = 'none';
            articleContent.style.display = 'block';
            editIcon.classList.remove('fa-eye');
            editIcon.classList.add('fa-pencil');
          } else {
            markdownEditor.style.display = 'block';
            articleContent.style.display = 'none';
            editIcon.classList.remove('fa-pencil');
            editIcon.classList.add('fa-eye');

            // 重新初始化编辑器
            setTimeout(() => {
              if (window.simplemde && window.simplemde.codemirror) {
                window.simplemde.codemirror.refresh();
              }
            }, 100);
          }
        });
      }


      // 返回顶部按钮（需确保元素存在）
      const backToTopButton = document.getElementById('back-to-top');
      if (backToTopButton) {
        window.addEventListener('scroll', () => {
          if (window.pageYOffset > 300) {
            backToTopButton.classList.remove('opacity-0', 'invisible');
            backToTopButton.classList.add('opacity-100', 'visible');
          } else {
            backToTopButton.classList.remove('opacity-100', 'visible');
            backToTopButton.classList.add('opacity-0', 'invisible');
          }
        });

        backToTopButton.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }


      // 点击页面其他区域关闭面板
      document.addEventListener('click', (event) => {
        // 关闭搜索面板
        if (searchPanel && !searchPanel.contains(event.target) && event.target !== searchToggle) {
          searchPanel.classList.add('hidden');
        }

        // 关闭设置面板
        if (settingsPanel && !settingsPanel.contains(event.target) && event.target !== settingsToggle) {
          settingsPanel.classList.add('hidden');
        }
      });


      // 导航栏滚动效果（需确保元素存在）
      const header = document.getElementById('main-header');
      if (header) {
        window.addEventListener('scroll', () => {
          if (window.pageYOffset > 50) {
            header.classList.add('shadow-md');
            header.classList.remove('shadow-sm');
          } else {
            header.classList.remove('shadow-md');
            header.classList.add('shadow-sm');
          }
        });
      }
    }
  });
</script>