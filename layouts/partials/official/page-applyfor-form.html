<!-- 账号申请表单区 -->
<section id="apply" class="max-w-4xl mx-auto bg-white rounded-xl p-6 md:p-10 card-shadow">
  <!-- 表单内容保持不变 -->
  <div class="text-center mb-8 md:mb-10">
    <h3 class="text-2xl md:text-3xl font-bold mb-4">账号申请表单</h3>
    <p class="text-gray-600">
      请准确填写以下信息，我们将在1-3个工作日内完成审核并反馈
    </p>
  </div>

  <form id="applyForm" class="space-y-6">
    <!-- 企业信息 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="companyName" class="block text-gray-700 font-medium mb-2">企业名称 <span
            class="text-red-500">*</span></label>
        <input type="text" id="companyName" name="companyName" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors"
          placeholder="请输入企业全称">
      </div>
      <div>
        <label for="industry" class="block text-gray-700 font-medium mb-2">所属行业 <span
            class="text-red-500">*</span></label>
        <select id="industry" name="industry" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors">
          <option value="">请选择行业</option>
          <option value="retail">零售批发</option>
          <option value="manufacture">生产制造</option>
          <option value="logistics">物流仓储</option>
          <option value="food">食品生鲜</option>
          <option value="other">其他行业</option>
        </select>
      </div>
    </div>

    <!-- 联系人信息 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="contactName" class="block text-gray-700 font-medium mb-2">联系人姓名 <span
            class="text-red-500">*</span></label>
        <input type="text" id="contactName" name="contactName" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors"
          placeholder="请输入联系人姓名">
      </div>
      <div>
        <label for="contactPhone" class="block text-gray-700 font-medium mb-2">联系电话 <span
            class="text-red-500">*</span></label>
        <input type="tel" id="contactPhone" name="contactPhone" required pattern="1[3-9]\d{9}"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors"
          placeholder="请输入11位手机号">
      </div>
    </div>

    <div>
      <label for="contactEmail" class="block text-gray-700 font-medium mb-2">电子邮箱 <span
          class="text-red-500">*</span></label>
      <input type="email" id="contactEmail" name="contactEmail" required
        class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors"
        placeholder="请输入常用邮箱（用于接收账号信息）">
    </div>

    <!-- 申请说明 -->
    <div>
      <label for="applyDesc" class="block text-gray-700 font-medium mb-2">申请说明（可选）</label>
      <textarea id="applyDesc" name="applyDesc" rows="4"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-colors"
        placeholder="请描述您的使用场景或特殊需求（如：需要管理1000+SKU库存）"></textarea>
    </div>

    <!-- 同意条款 -->
    <div class="flex items-start">
      <input type="checkbox" id="agreeTerms" name="agreeTerms" required class="mt-1 mr-3 text-primary input-focus">
      <label for="agreeTerms" class="text-gray-600 text-sm">
        我已阅读并同意<a href="#" class="text-primary hover:underline">《系统使用协议》</a>和<a href="#"
          class="text-primary hover:underline">《隐私政策》</a>
      </label>
    </div>

    <!-- 提交按钮 -->
    <div class="text-center pt-4">
      <button type="submit" id="submitBtn"
        class="w-full md:w-auto px-8 py-3 bg-primary text-white font-medium rounded-lg hover:bg-primary/90 transition-colors shadow-lg hover:shadow-xl">
        <i class="fa fa-paper-plane mr-2"></i>提交申请
      </button>
    </div>
  </form>

  <!-- 提交成功弹窗 -->
  <div id="successModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
      <div
        class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-green-500 text-2xl mx-auto mb-4">
        <i class="fa fa-check"></i>
      </div>
      <h4 class="text-xl font-bold mb-2">申请提交成功！</h4>
      <p class="text-gray-600 mb-6">
        我们已收到您的申请，审核结果将在1-3个工作日内通过短信/邮件通知您
      </p>
      <button id="closeModal" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
        确认
      </button>
    </div>
  </div>

  <!-- 错误提示弹窗 -->
  <div id="errorModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
      <div
        class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-red-500 text-2xl mx-auto mb-4">
        <i class="fa fa-exclamation-circle"></i>
      </div>
      <h4 class="text-xl font-bold mb-2">提交失败</h4>
      <p class="text-gray-600 mb-6" id="errorMessage">
        请稍后重试，或联系客服获取帮助
      </p>
      <button id="closeErrorModal"
        class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
        关闭
      </button>
    </div>
  </div>
</section>

<!-- JavaScript -->
<script>
  // 移动端菜单切换
  const menuBtn = document.getElementById('menuBtn');
  const mobileMenu = document.getElementById('mobileMenu');
  menuBtn.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });

  // 表单提交处理
  const applyForm = document.getElementById('applyForm');
  const successModal = document.getElementById('successModal');
  const errorModal = document.getElementById('errorModal');
  const errorMessage = document.getElementById('errorMessage');
  const closeModal = document.getElementById('closeModal');
  const closeErrorModal = document.getElementById('closeErrorModal');
  const submitBtn = document.getElementById('submitBtn');

  applyForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // 阻止默认提交


    const email = document.getElementById('contactEmail').value.trim();
    const company = document.getElementById('companyName').value.trim();
    const phone = document.getElementById('contactPhone').value.trim();
    const interest = document.getElementById('industry').value;
    

    // 准备表单数据（与接口字段映射）
    const formData = {
      name: document.getElementById('contactName').value.trim(), // 联系人姓名
      email: document.getElementById('contactEmail').value.trim(), // 电子邮箱
      phone: document.getElementById('contactPhone').value.trim(), // 联系电话
      company: document.getElementById('companyName').value.trim(), // 企业名称
      interest: document.getElementById('industry').value, // 所属行业（映射为interest字段）
      message: email + company + phone + interest + document.getElementById('applyDesc').value.trim(), // 申请说明
      origin: document.title || '进销库存系统账号申请' // 来源页面标题
    };

    // 提交状态处理
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>提交中...';

    try {
      // 发送请求到指定接口
      const response = await fetch('https://handle.lehuye.com/users/postcontactus', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'authorization': 'keebone'
        },
        body: JSON.stringify(formData),
        mode: 'cors',
        credentials: 'include'
      });

      // 处理响应
      if (!response.ok) {
        throw new Error(`HTTP错误，状态码: ${response.status}`);
      }

      const result = await response.json();

      // 假设接口返回成功状态（根据实际接口调整判断条件）
      if (result.success || response.ok) {
        successModal.classList.remove('hidden');
        applyForm.reset(); // 重置表单
      } else {
        throw new Error(result.message || '提交失败，请检查信息后重试');
      }
    } catch (error) {
      // 错误处理
      console.error('提交失败:', error);
      errorMessage.textContent = error.message || '网络异常，请稍后重试';
      errorModal.classList.remove('hidden');
    } finally {
      // 恢复按钮状态
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fa fa-paper-plane mr-2"></i>提交申请';
    }
  });

  // 关闭弹窗事件
  closeModal.addEventListener('click', () => {
    successModal.classList.add('hidden');
  });

  closeErrorModal.addEventListener('click', () => {
    errorModal.classList.add('hidden');
  });

  // 点击弹窗外部关闭
  [successModal, errorModal].forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
      }
    });
  });

  // 手机号格式验证
  const contactPhone = document.getElementById('contactPhone');
  contactPhone.addEventListener('input', () => {
    const phoneValue = contactPhone.value;
    if (phoneValue.length > 0 && !/^1[3-9]\d{0,9}$/.test(phoneValue)) {
      contactPhone.setCustomValidity('请输入正确的11位手机号');
    } else {
      contactPhone.setCustomValidity('');
    }
  });
</script>